apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: argocd-server-ingress
  namespace: argocd
  annotations:
    # ArgoCD runs with server.insecure=true (set in argocd-cmd-params-cm).
    # TLS is terminated here at F5 NGINX; backend is plain HTTP on pod port 8080.
    #
    # F5 NGINX (nginx.org/stable chart) uses nginx.org/* annotations only.
    # nginx.ingress.kubernetes.io/* annotations are silently ignored.
    #
    # Disable response buffering so gRPC-Web streaming frames are forwarded
    # to the client immediately (prevents CLI "context deadline exceeded").
    nginx.org/proxy-buffering: "false"
    # Long timeouts for WebSocket and gRPC-Web streaming.
    nginx.org/proxy-read-timeout: "3600s"
    nginx.org/proxy-send-timeout: "3600s"
    nginx.org/proxy-connect-timeout: "120s"
spec:
  ingressClassName: nginx
  rules:
  - host: argocd.amok
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: argocd-server
            port:
              name: http
  tls:
  - hosts:
    - argocd.amok
    secretName: argocd-tls
